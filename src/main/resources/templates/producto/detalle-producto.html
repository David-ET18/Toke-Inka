<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:insert="~{_layout :: html(content=~{::content})}">

<body>
    <div th:fragment="content" th:object="${producto}">
        <div class="sub-main">
            <!-- Contenedor Principal (Grid) -->
            <div class="container-prod-details">
                
                <!-- Columna Izquierda: Imagen -->
                <div class="img-container shadow-sm">
                    <!-- Validación por si no hay imagen -->
                    <img th:src="*{urlImagen != null ? urlImagen : 'https://via.placeholder.com/500'}" 
                         alt="Imagen del producto">
                </div>

                <!-- Columna Derecha: Detalles -->
                <div class="info-container">
                    <span class="category-badge" th:text="*{nombreCategoria}">Categoría</span>
                    <h1 th:text="*{nombre}">Nombre del Producto</h1>
                    
                    <p class="price-tag"
                        th:text="|S/ ${#numbers.formatDecimal(producto.precio, 1, 'COMMA', 2, 'POINT')}|">
                        S/ 0.00
                    </p>
                    
                    <p class="description" th:text="*{descripcion}">
                        Descripción detallada del producto.
                    </p>

                    <!-- Formulario de Compra -->
                    <form th:action="@{/carrito/agregar}" method="post">
                        <input type="hidden" name="productoId" th:value="*{id}">
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="tallaId" class="form-label">Talla</label>
                                <select id="tallaId" name="tallaId" class="form-select" required>
                                    <option value="" disabled selected>Seleccionar</option>
                                    <option value="1">S</option>
                                    <option value="2">M</option>
                                    <option value="3">L</option>
                                    <!-- Aquí idealmente iterarías sobre las tallas reales -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="cantidad" class="form-label">Cantidad</label>
                                <input type="number" id="cantidad" name="cantidad" class="form-control" value="1" min="1" required>
                            </div>
                            
                            <div class="col-12 mt-4">
                                <button type="submit" class="btn-agregarAlCarrito">
                                    <i class="bi bi-cart-plus-fill"></i> Agregar al Carrito
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sección de Reseñas -->
            <div class="reviews-section mt-5">
                <h3><i class="bi bi-star-fill text-warning me-2"></i>Reseñas de Clientes</h3>
                
                <div th:if="${#lists.isEmpty(producto.reseñas)}" class="alert alert-light text-center">
                    <p class="mb-0 text-muted">Este producto aún no tiene reseñas. ¡Sé el primero en opinar!</p>
                </div>

                <div th:unless="${#lists.isEmpty(producto.reseñas)}" class="list-group list-group-flush">
                    <div th:each="resena : ${producto.reseñas}" class="list-group-item">
                        <div class="d-flex w-100 justify-content-between align-items-center mb-2">
                            <h6 class="mb-0 fw-bold" th:text="${resena.nombreUsuario}">Usuario</h6>
                            <small class="text-muted" th:text="${#temporals.format(resena.fechaResena, 'dd/MM/yyyy')}">Fecha</small>
                        </div>
                        <!-- Estrellitas simuladas -->
                        <div class="mb-2 text-warning">
                            <i class="bi bi-star-fill" th:each="i : ${#numbers.sequence(1, resena.calificacion)}"></i>
                            <i class="bi bi-star" th:each="i : ${#numbers.sequence(resena.calificacion + 1, 5)}" th:if="${resena.calificacion < 5}"></i>
                        </div>
                        <p class="mb-1 text-secondary" th:text="${resena.comentario}">Comentario.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>