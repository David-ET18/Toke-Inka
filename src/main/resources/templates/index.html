<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:insert="~{_layout :: html(content=~{::content})}">

<!-- Define el bloque de contenido -->
<th:block th:fragment="content">

  <!-- ========================================== -->
  <!-- PARTE 1: DISEÑO NUEVO (CARRUSEL Y BANNER)  -->
  <!-- ========================================== -->
  
  <!-- Carrusel de Imágenes -->
  <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img th:src="@{/images/1_carrusel.png}" class="d-block w-100" alt="Colección 1">
      </div>
      <div class="carousel-item">
        <img th:src="@{/images/2_carrusel.png}" class="d-block w-100" alt="Colección 2">
      </div>
      <div class="carousel-item">
        <img th:src="@{/images/3_carrusel.png}" class="d-block w-100" alt="Colección 3">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

  <!-- Banner con Movimiento (Marquee) -->
  <div id="welcome-banner" class="container-Bienvenida-mssg my-4">
    <marquee scrollamount="10" class="container">
      <h1 class="Bienvenido-MSSG d-inline">Bienvenido a Toke Inca</h1>
      <span class="mx-3">|</span>
      <p class="Bienvenida-parrafo d-inline">La moda que inspira, el estilo que te define. Descubre nuestras últimas colecciones.</p>
    </marquee>
  </div>

  <!-- Contenedor Principal del Nuevo Diseño -->
  <div class="sub-main container">
    
    <!-- Modal de Video -->
    <div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title text-brown" id="videoModalLabel">Video de Bienvenida</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body p-0">
            <div class="ratio ratio-16x9">
              <iframe src="https://www.youtube.com/embed/ngii7wwXSvg"
                title="Video Promocional" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Alerta de pedido exitoso (Backend - Fallback) -->
    <div th:if="${pedidoExitoso}" class="alert alert-success mt-3" role="alert" th:text="${pedidoExitoso}"></div>

    <!-- Sección de Productos -->
    <div class="viewProductos mt-4">
      <h2 id="product-section-title" class="text-center mb-4">Nuestros Productos</h2>
      
      <!-- Lista de Productos (Estilo Nuevo) -->
      <div id="product-list-container" class="container-products d-flex flex-wrap justify-content-center gap-4">
        <div class="col-auto" th:each="producto : ${productos}">
          <div class="product-card shadow-sm h-100">
            <div class="container-img">
                <!-- He añadido la validación de imagen nula al diseño nuevo -->
                <img th:src="${producto.urlImagen != null ? producto.urlImagen : 'https://via.placeholder.com/300'}" 
                     class="img-prod" alt="Imagen de producto">
            </div>
            <div class="card-body p-3">
              <h5 class="card-title" th:text="${producto.nombre}">Nombre Producto</h5>
              <p class="card-text text-muted" th:text="${producto.nombreCategoria}">Categoría</p>
              <p class="card-text fs-5 fw-bold text-success"
                th:text="|S/ ${#numbers.formatDecimal(producto.precio, 1, 'COMMA', 2, 'POINT')}|">S/ 0.00</p>
            </div>
            <div class="card-footer bg-transparent border-0 text-center pb-3">
              <a th:href="@{/producto/{id}(id=${producto.id})}" class="btn btn-primary btn-detalle">Ver Detalles</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================== -->
  <!-- PARTE 2: LÓGICA DE PAGOS (SWEETALERT)                          -->
  <!-- Esto hace que salga el popup verde al terminar de pagar         -->
  <!-- ============================================================== -->
  
  <!-- 1. Importar la librería SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- 2. Lógica para detectar la redirección de éxito -->
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          // Buscamos en la URL si existe el parámetro ?payment_success=true
          const urlParams = new URLSearchParams(window.location.search);
          
          if (urlParams.get('payment_success') === 'true') {
              // Lanzamos la alerta animada
              Swal.fire({
                  title: '¡Pago Realizado con Éxito!',
                  text: 'Gracias por tu compra en Toke Inca. Hemos enviado el comprobante a tu correo.',
                  icon: 'success',
                  confirmButtonColor: '#198754', // Color verde
                  confirmButtonText: 'Genial, seguir viendo',
                  backdrop: true,
                  timer: 5000, 
                  timerProgressBar: true
              }).then((result) => {
                  // Limpiamos la URL para que no salga la alerta si recarga la página
                  const url = new URL(window.location);
                  url.searchParams.delete('payment_success');
                  window.history.replaceState(null, '', url);
              });
          }
      });
  </script>

</th:block>
</html>