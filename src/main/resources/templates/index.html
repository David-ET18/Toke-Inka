<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:insert="~{_layout :: html(content=~{::content})}">

<!-- Define el bloque de contenido -->
<th:block th:fragment="content">

  <!-- ========================================== -->
  <!-- SECCIÓN 1: HERO (Carrusel)                 -->
  <!-- ========================================== -->
  <div id="carouselExample" class="carousel slide shadow-lg" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img th:src="@{/images/1_carrusel.png}" class="d-block w-100 hero-img" alt="Colección 1">
        <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
            <h2 class="text-white fw-bold text-uppercase">Nueva Colección 2025</h2>
            <p>Descubre la fusión perfecta entre tradición y modernidad.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img th:src="@{/images/2_carrusel.png}" class="d-block w-100 hero-img" alt="Colección 2">
        <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
            <h2 class="text-white fw-bold text-uppercase">Calidad Premium</h2>
            <p>Algodón Pima 100% Peruano para tu comodidad.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img th:src="@{/images/3_carrusel.png}" class="d-block w-100 hero-img" alt="Colección 3">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Anterior</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Siguiente</span>
    </button>
  </div>

  <!-- ========================================== -->
  <!-- SECCIÓN 2: BIENVENIDA (Marquee)            -->
  <!-- ========================================== -->
  <div id="welcome-banner" class="container-Bienvenida-mssg my-4 py-3 shadow-sm" style="border-top: 3px solid #E9B44C; border-bottom: 3px solid #E9B44C; background-color: #1D2D44;">
    <div class="container overflow-hidden">
        <marquee scrollamount="8" class="d-flex align-items-center">
          <h1 class="d-inline me-4 mb-0 text-white" style="font-family: 'Montserrat', sans-serif; font-weight: 800; text-transform: uppercase; font-size: 1.5rem; color: #E9B44C !important;">Bienvenido a Toke Inca</h1>
          <span class="text-white mx-3">|</span>
          <p class="d-inline mb-0 text-light" style="font-family: 'Lato', sans-serif; font-weight: 300;">La moda que inspira, el estilo que te define. Envíos gratis a todo el Perú por compras mayores a S/ 200.</p>
        </marquee>
    </div>
  </div>

  <div class="sub-main container">
    
    <!-- ========================================== -->
    <!-- SECCIÓN EXTRA: SOBRE NOSOTROS (Misión/Visión) -->
    <!-- ========================================== -->
    <div class="row mb-5 py-5 align-items-center">
        <div class="col-lg-6 mb-4 mb-lg-0">
            <h2 class="text-secondary fw-bold text-uppercase mb-3" style="border-left: 5px solid #C05640; padding-left: 15px;">Nuestra Esencia</h2>
            <p class="lead text-muted mb-4">Más que una marca de ropa, somos un movimiento que revaloriza nuestra historia.</p>
            
            <div class="d-flex mb-4">
                <div class="flex-shrink-0">
                    <div class="bg-primary bg-opacity-10 rounded-circle p-3 text-primary">
                        <i class="bi bi-gem fs-3"></i>
                    </div>
                </div>
                <div class="flex-grow-1 ms-3">
                    <h5 class="fw-bold">Misión</h5>
                    <p class="small text-secondary">Diseñar prendas únicas que fusionen la iconografía ancestral con las tendencias urbanas globales, empoderando a quienes las visten con orgullo de su identidad.</p>
                </div>
            </div>
            
            <div class="d-flex">
                <div class="flex-shrink-0">
                    <div class="bg-warning bg-opacity-10 rounded-circle p-3 text-warning">
                        <i class="bi bi-eye fs-3"></i>
                    </div>
                </div>
                <div class="flex-grow-1 ms-3">
                    <h5 class="fw-bold">Visión</h5>
                    <p class="small text-secondary">Ser la marca referente de moda cultural en Latinoamérica, reconocida por nuestra calidad, innovación y compromiso con el legado Inka.</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <!-- Tarjeta de Video Mejorada -->
            <div class="card border-0 shadow-lg overflow-hidden rounded-4 position-relative">
                <div class="ratio ratio-16x9">
                    <!-- Placeholder de imagen si el video tarda en cargar o como portada -->
                    <iframe src="https://www.youtube.com/embed/ngii7wwXSvg?controls=0&rel=0"
                        title="Video Promocional" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen></iframe>
                </div>
                <div class="card-img-overlay d-flex align-items-end p-0">
                    <div class="bg-dark bg-opacity-75 w-100 p-3 text-white">
                        <h6 class="mb-0"><i class="bi bi-play-circle me-2"></i>Descubre la Experiencia Toke Inca</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- SECCIÓN EXTRA: BENEFICIOS (Iconos)         -->
    <!-- ========================================== -->
    <div class="row g-4 mb-5 text-center">
        <div class="col-md-4">
            <div class="p-4 border rounded-3 bg-white h-100 shadow-sm transition-card">
                <i class="bi bi-truck fs-1 text-primary mb-3"></i>
                <h5 class="fw-bold">Envíos Seguros</h5>
                <p class="text-muted small">Llegamos a todo el Perú con nuestros partners logísticos de confianza.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="p-4 border rounded-3 bg-white h-100 shadow-sm transition-card">
                <i class="bi bi-shield-check fs-1 text-primary mb-3"></i>
                <h5 class="fw-bold">Compra Protegida</h5>
                <p class="text-muted small">Tus pagos son procesados con la máxima seguridad bancaria vía Culqi.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="p-4 border rounded-3 bg-white h-100 shadow-sm transition-card">
                <i class="bi bi-stars fs-1 text-primary mb-3"></i>
                <h5 class="fw-bold">Calidad Garantizada</h5>
                <p class="text-muted small">Si no te queda o no te gusta, tienes 7 días para cambios fáciles.</p>
            </div>
        </div>
    </div>

    <!-- Alerta de Fallback (Backend) -->
    <div th:if="${pedidoExitoso}" class="alert alert-success mt-4 shadow-sm" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i> <span th:text="${pedidoExitoso}"></span>
    </div>

    <!-- ========================================== -->
    <!-- SECCIÓN 4: PRODUCTOS                       -->
    <!-- ========================================== -->
    <div class="viewProductos mt-5">
      <!-- ID product-section-title necesario para el Tour -->
      <h2 id="product-section-title" class="text-center mb-5 position-relative text-uppercase fw-bold" style="color: #1D2D44; letter-spacing: 1px;">
          <span class="bg-body px-3 z-1 position-relative">Catálogo Destacado</span>
          <div class="position-absolute top-50 start-0 w-100 border-bottom z-0" style="border-color: #E9B44C !important;"></div>
      </h2>
      
      <!-- ID product-list-container necesario para el Tour -->
      <div id="product-list-container" class="container-products row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-4 justify-content-center">
        
        <!-- Iteración de Productos -->
        <div class="col" th:each="producto : ${productos}">
          <div class="product-card h-100 d-flex flex-column border-0 shadow-sm rounded-3 overflow-hidden" style="transition: transform 0.3s ease;">
            
            <!-- Imagen con validación -->
            <div class="container-img position-relative overflow-hidden bg-white" style="padding-top: 100%;">
                <img th:src="${producto.urlImagen != null ? producto.urlImagen : 'https://via.placeholder.com/300x300?text=Sin+Imagen'}" 
                     class="img-prod w-100 h-100 position-absolute top-0 start-0 object-fit-contain p-3" 
                     alt="Imagen de producto"
                     style="transition: transform 0.5s ease;">
                <!-- Badge Nuevo (Opcional) -->
                <span class="badge bg-primary position-absolute top-0 end-0 m-3 shadow-sm">Nuevo</span>
            </div>

            <div class="card-body p-4 flex-grow-1 d-flex flex-column text-center bg-white">
              <h5 class="card-title fw-bold mb-1 text-dark text-truncate" th:text="${producto.nombre}">Nombre</h5>
              <p class="card-text text-muted small text-uppercase mb-3" th:text="${producto.nombreCategoria}">Categoría</p>
              
              <div class="mt-auto">
                  <p class="card-text fs-4 fw-bold text-primary mb-3"
                    th:text="|S/ ${#numbers.formatDecimal(producto.precio, 1, 'COMMA', 2, 'POINT')}|">S/ 0.00</p>
              </div>
            </div>

            <div class="card-footer bg-white border-0 pb-4 text-center">
              <a th:href="@{/producto/{id}(id=${producto.id})}" 
                 class="btn btn-outline-primary rounded-pill px-4 fw-bold w-100 stretched-link transition-btn"
                 style="border-width: 2px;">
                  Ver Detalles
              </a>
            </div>

          </div>
        </div>

      </div>
      
      <!-- Botón Ver Todo -->
      <div class="text-center mt-5">
          <a th:href="@{/productos}" class="btn btn-secondary rounded-pill px-5 py-2 shadow fw-bold">Ver Catálogo Completo</a>
      </div>
    </div>
  </div>

  <!-- Estilos inline extra para efectos rápidos -->
  <style>
      .product-card:hover {
          transform: translateY(-10px);
          box-shadow: 0 1rem 3rem rgba(0,0,0,.175)!important;
      }
      .product-card:hover .img-prod {
          transform: scale(1.08);
      }
      .transition-card:hover {
          transform: translateY(-5px);
          border-color: #C05640 !important;
      }
  </style>

  <!-- ============================================================== -->
  <!-- SCRIPTS DE PAGO (INTEGRACIÓN CULQI/SWEETALERT)                 -->
  <!-- ============================================================== -->
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const urlParams = new URLSearchParams(window.location.search);
          
          if (urlParams.get('payment_success') === 'true') {
              Swal.fire({
                  title: '¡Pago Realizado con Éxito!',
                  html: `
                    <p class="mb-4">Gracias por tu compra en <strong>Toke Inca</strong>.</p>
                    <p class="text-muted small">Hemos enviado el comprobante a tu correo.</p>
                  `,
                  icon: 'success',
                  confirmButtonColor: '#C05640', // Color Primary (Terracota)
                  confirmButtonText: 'Genial, seguir viendo',
                  backdrop: `rgba(0,0,0,0.4)`,
                  timer: 6000, 
                  timerProgressBar: true
              }).then((result) => {
                  const url = new URL(window.location);
                  url.searchParams.delete('payment_success');
                  window.history.replaceState(null, '', url);
              });
          }
      });
  </script>

</th:block>
</html>